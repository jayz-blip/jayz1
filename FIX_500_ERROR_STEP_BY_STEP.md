# 500 에러 단계별 해결 가이드

## 🔴 현재 문제

**Error 1101: Worker threw exception**이 계속 발생하고 있습니다.

## ✅ 해결 전략: 단계별 접근

복잡한 코드 대신 **간단한 테스트 코드**로 시작하여 문제를 단계적으로 해결합니다.

## 🚀 1단계: 간단한 테스트 코드로 배포

### 목적
- Workers가 기본적으로 작동하는지 확인
- D1, AI Workers 없이도 응답이 오는지 확인

### 방법

1. **Cloudflare 대시보드 접속**:
   - https://dash.cloudflare.com/
   - Workers & Pages → Workers → `chatbot-api`

2. **코드 편집**:
   - "배포" 탭 → "</> 코드 편집" 클릭
   - **`worker/src/worker_simple.py`** 파일 내용 복사
   - 에디터에 붙여넣기
   - **"저장 및 배포"** 클릭

3. **테스트**:
   - `https://chatbot-api.jayz-407.workers.dev/api/chat` 접속
   - GET 요청 시 안내 메시지가 표시되어야 합니다
   - POST 요청 시 "테스트 응답"이 표시되어야 합니다

### 성공하면
- Workers 자체는 정상 작동
- 문제는 D1 또는 AI Workers 바인딩에 있음

### 실패하면
- Workers 코드 자체에 문제
- 또는 환경 설정 문제

## 🔍 2단계: 로그 확인 (가장 중요!)

### 방법

1. **Cloudflare 대시보드**:
   - Workers & Pages → Workers → `chatbot-api`
   - **"관찰 가능성"** 탭 클릭

2. **"이벤트" 탭 확인**:
   - 최근 오류 이벤트 클릭
   - **오류 메시지 복사**
   - **스택 트레이스 확인**

3. **오류 메시지 분석**:
   - 어떤 함수에서 오류가 발생했는지 확인
   - 어떤 라인에서 오류가 발생했는지 확인

## 🔧 3단계: 문제별 해결

### 문제 A: D1 바인딩 오류

**증상**: "D1 database binding is not configured"

**해결**:
1. `wrangler.toml` 확인
2. D1 데이터베이스 ID 확인
3. Workers 설정에서 D1 바인딩 확인

### 문제 B: AI Workers 바인딩 오류

**증상**: "AI Workers binding is not configured"

**해결**:
1. `wrangler.toml`에서 `[ai]` 설정 확인
2. Workers 설정에서 AI 바인딩 확인

### 문제 C: 코드 오류

**증상**: 특정 함수에서 예외 발생

**해결**:
1. 오류가 발생한 함수 확인
2. 해당 함수 수정
3. 재배포

## 📋 체크리스트

- [ ] 간단한 테스트 코드 배포
- [ ] GET 요청 테스트 성공
- [ ] POST 요청 테스트 성공
- [ ] 로그에서 오류 메시지 확인
- [ ] 오류 원인 파악
- [ ] 문제별 해결 방법 적용

## 💡 중요 팁

1. **로그가 가장 중요합니다!**
   - 로그 없이는 정확한 원인을 알 수 없습니다
   - 반드시 "관찰 가능성" 탭에서 로그를 확인하세요

2. **단계별 접근**:
   - 복잡한 코드 대신 간단한 코드로 시작
   - 작동하는 것을 확인한 후 기능 추가

3. **인내심**:
   - 문제 해결에는 시간이 걸립니다
   - 로그를 통해 정확한 원인을 찾으면 해결할 수 있습니다

---

**먼저 간단한 테스트 코드로 배포하고, 로그를 확인하세요!**

